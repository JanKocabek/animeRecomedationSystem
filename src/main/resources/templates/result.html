<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Anime Recommendations</title>
    <!-- Theme CSS -->

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/assets/css/material-kit.min.css}" rel="stylesheet">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/dist/tabler-icons.min.css"/>

    <link th:href="@{/assets/css/main.css}" rel="stylesheet">
</head>
<body class="bg-light">
<!-- Hero Section -->
<header th:insert="fragments/header :: header"></header>
<main>


    <!-- Recommendations Section -->
    <section class="py-5">
        <div class="container">
            <h2 class="mb-4"
                th:text="'Anime Recommendations for: ' + ${#strings.listJoin(recommendations.inputAnimeNames, ', ')}"></h2>
            <div class="row g-4">
                <div th:each="recommend : ${recommendations.getRecommendedAnime()}"
                     class="col-sm-6 col-md-4 col-lg-3">
                    <div class="card shadow-sm h-100">
                        <!-- Image -->
                        <a th:href="@{'https://myanimelist.net/anime/' + ${recommend.animeId} + '/'}">
                            <img th:src="${recommend.animeInfo.imageURL}"
                                 th:alt="${recommend.animeInfo.name}"
                                 class="card-img-top img-fluid">
                        </a>

                        <!-- Card Body -->
                        <div class="card-body d-flex flex-column flex-grow-1 ">
                            <h5 class="card-title mb-3" th:text="${recommend.animeInfo.name}"></h5>

                            <div class="d-flex flex-column justify-content-center flex-grow-1">
                                <div class="card-text d-flex flex-row justify-content-between align-items-start ">
                                    <!-- Left side: Recommendation text -->
                                    <div class="d-flex flex-column align-items-center me-3">
                                        <small class="text-muted mb-2" style="font-style: italic;">Rated by</small>
                                        <div class="vertical-progress" style="height: 100px; width: 50px;">
                                            <div class="vertical-progress-bar"
                                                 th:style="'height: calc(' + ${recommend.percentageOccurrences} + '% + 15px); background-color:' +
                       (${recommend.percentageOccurrences} >= 70 ? '#28a745' :
                        (${recommend.percentageOccurrences} >= 40 ? '#ffc107' : '#dc3545'))">
                                                <div class="d-flex flex-column align-items-center">
                                                    <span th:text="${#numbers.formatDecimal(recommend.percentageOccurrences, 1, 2)} + '%'"></span>
                                                    <small>users</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                    <!-- Right side: Genre pills aligned to right -->
                                    <div class="d-flex flex-column align-items-end ms-auto">
                                        <span class="badge bg-secondary mb-2">Genres:</span>
                                        <span th:each="genre : ${recommend.animeInfo.genres}"
                                              class="badge rounded-pill bg-secondary mb-1"
                                              th:text="${genre}"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Badges -->
                        <div class="d-flex justify-content-between mt-3 ">
                                <span class="badge bg-success"
                                      th:text="'Avg: ' + ${#numbers.formatDecimal(recommend.getAverageRating(), 1, 2)}">
                                </span>
                            <span class="badge bg-info">
                                <i class="ti ti-world fs-6"></i>
                                <span th:text="'MAL: ' + ${recommend.animeInfo.score}"></span>
                                </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>
<!--footer-->
<footer class="bg-dark text-white py-4 text-center">
    <div class="container">
        <p class="mb-1">
            Photo by <a
                href="https://unsplash.com/@iangvalerio?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash"
                class="text-white text-decoration-none">Ian Valerio</a> on <a
                href="https://unsplash.com/photos/aerial-view-photography-of-road-between-highrise-building-CAFq0pv9HjY?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash"
                class="text-white text-decoration-none">Unsplash</a>
            | Made with Bootstrap & Material Kit | Jan Koc√°bek &copy; 2025
        </p>
    </div>
</footer>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Toggle functionality
        const toggleInput = document.getElementById('toggleAdvanced');
        const advancedOptions = document.getElementById('advancedOptions');
        const collapseInstance = new bootstrap.Collapse(advancedOptions, {
            toggle: false
        });

        toggleInput.addEventListener('change', function () {
            if (this.checked) {
                collapseInstance.show();
            } else {
                collapseInstance.hide();
            }
        });

        // Range slider updates
        document.getElementById('minRatingRange').addEventListener('input', function () {
            document.getElementById('minRatingValue').textContent = this.value;
        });

        document.getElementById('maxUsersRange').addEventListener('input', function () {
            document.getElementById('maxUsersValue').textContent = this.value;
        });

        // Preset functions
        window.setPreset = function (preset) {
            const minRating = document.getElementById('minRatingRange');
            const maxUsers = document.getElementById('maxUsersRange');
            const minRatingValue = document.getElementById('minRatingValue');
            const maxUsersValue = document.getElementById('maxUsersValue');

            switch (preset) {
                case 'fast':
                    minRating.value = 9;
                    maxUsers.value = 250;
                    break;
                case 'balanced':
                    minRating.value = 8;
                    maxUsers.value = 750;
                    break;
                case 'comprehensive':
                    minRating.value = 7;
                    maxUsers.value = 1500;
                    break;
            }

            minRatingValue.textContent = minRating.value;
            maxUsersValue.textContent = maxUsers.value;
        };
    });
</script>
<script src="/assets/js/core/bootstrap.bundle.min.js"></script>
<script src="/assets/js/core/bootstrap.min.js"></script>
<script src="/assets/js/core/popper.min.js"></script>
<script src="/assets/js/material-kit.min.js"></script>
</body>
</html>
